<Window x:Class="AutoPhotoEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:gif="http://wpfanimatedgif.codeplex.com"
        mc:Ignorable="d"
        Title="Auto Photo Editor"
        Background="#F5F5F5"
        FontFamily="Segoe UI" FontSize="16" WindowState="Maximized" WindowStartupLocation="CenterScreen" Loaded="Window_Loaded" Closed="Window_Closed">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="300" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Left image area with zoom & styling -->
        <Border Grid.Column="0"
            Margin="20"
            Background="White"
            CornerRadius="10"
            Padding="10"
            Effect="{DynamicResource DropShadowEffect}">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="150" />
                </Grid.RowDefinitions>

                <!-- Image scrollviewer in first row -->
                <!-- Image display area -->
                <!-- Wrap normal viewer + comparison viewer together -->
                <Grid Grid.Row="0">
                    <!-- Normal single image viewer -->
                    <ScrollViewer x:Name="ImageScrollViewer"
                  HorizontalScrollBarVisibility="Auto"
                  VerticalScrollBarVisibility="Auto"
                  PreviewMouseWheel="ImageScrollViewer_PreviewMouseWheel">
                        <Grid x:Name="ImageContainerGrid"
              Background="White"
              MouseDown="ImageGrid_MouseDown"
              MouseMove="ImageGrid_MouseMove"
              MouseUp="ImageGrid_MouseUp"
              AllowDrop="True"
              Drop="ImageContainerGrid_Drop"
              DragEnter="ImageContainerGrid_DragEnter"
              DragLeave="ImageContainerGrid_DragLeave">
                            <Image x:Name="DownloadedImage" RenderTransformOrigin="0,0" Stretch="None" Loaded="DownloadedImage_Loaded">
                                <Image.LayoutTransform>
                                    <ScaleTransform x:Name="ImageScaleTransform" ScaleX="1" ScaleY="1" />
                                </Image.LayoutTransform>
                            </Image>
                        </Grid>
                    </ScrollViewer>

                    <!-- Side-by-side comparison view -->
                    <Grid x:Name="ComparisonGrid" Visibility="Collapsed">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Left -->
                        <ScrollViewer x:Name="LeftImageScroll"
              PreviewMouseWheel="ComparisonImageScrollViewer_PreviewMouseWheel"
              HorizontalScrollBarVisibility="Auto"
              VerticalScrollBarVisibility="Auto">
                            <Grid Tag="{Binding ElementName=LeftImageScroll}"
          MouseDown="ComparisonImageGrid_MouseDown"
          MouseMove="ComparisonImageGrid_MouseMove"
          MouseUp="ComparisonImageGrid_MouseUp">
                                <Image x:Name="LeftImage" Stretch="None" RenderTransformOrigin="0,0">
                                    <Image.LayoutTransform>
                                        <ScaleTransform x:Name="LeftImageScaleTransform" ScaleX="1" ScaleY="1" />
                                    </Image.LayoutTransform>
                                </Image>
                            </Grid>
                        </ScrollViewer>

                        <!-- Right -->
                        <ScrollViewer x:Name="RightImageScroll"
              Grid.Column="1"
              PreviewMouseWheel="ComparisonImageScrollViewer_PreviewMouseWheel"
              HorizontalScrollBarVisibility="Auto"
              VerticalScrollBarVisibility="Auto"
              Background="{StaticResource CheckerboardBrush}">
                            <Grid Tag="{Binding ElementName=RightImageScroll}"
          MouseDown="ComparisonImageGrid_MouseDown"
          MouseMove="ComparisonImageGrid_MouseMove"
          MouseUp="ComparisonImageGrid_MouseUp">
                                <Image x:Name="RightImage" Stretch="None" RenderTransformOrigin="0,0">
                                    <Image.LayoutTransform>
                                        <ScaleTransform x:Name="RightImageScaleTransform" ScaleX="1" ScaleY="1" />
                                    </Image.LayoutTransform>
                                </Image>
                            </Grid>
                        </ScrollViewer>
                    </Grid>
                </Grid>

                <!-- Bottom thumbnails panel in second row -->
                <ScrollViewer Grid.Row="1"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Disabled"
                      Background="#EEE"
                      Padding="5"
                      Margin="0">

                    <StackPanel x:Name="ThumbnailPanel"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Margin="0" />
                </ScrollViewer>

                <!-- Drag Drop Overlay -->
                <Grid x:Name="DragDropOverlay"
                      Background="#80000000"
                      Visibility="Collapsed"
                      IsHitTestVisible="False"
                      Grid.RowSpan="2">

                    <TextBlock Text="Przeciągnij plik tutaj"
                       Foreground="White"
                       FontSize="30"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center" />
                </Grid>

                <!-- Loading overlay stays on top -->
                <Grid x:Name="LoadingOverlay" Background="#80000000" Visibility="Collapsed" Grid.RowSpan="2">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <Image Width="200" Height="200"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           gif:ImageBehavior.AnimatedSource="/Resources/loading-spinner.gif"
                           gif:ImageBehavior.RepeatBehavior="Forever" />
                        <TextBlock x:Name="LoadingStatusText"
                           Opacity="0"
                           VerticalAlignment="Bottom"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,10"
                           Foreground="White"
                           FontSize="20"
                           FontWeight="Bold"
                           Text="Ładowanie..."
                           Visibility="Visible" />
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>

        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Grid.Column="1"  VerticalAlignment="Top">
                <!-- Button Panel -->
                <Border Grid.Column="1"
                    VerticalAlignment="Top"
                    Margin="20"
                    Background="White"
                    CornerRadius="10"
                    Padding="20"
                    Effect="{DynamicResource DropShadowEffect}">

                    <StackPanel>
                        <TextBlock Text="Kontrolki" FontSize="20" FontWeight="Bold" Margin="0,0,0,20" />

                        <Button x:Name="OpenWithPsButton"
                            Height="50"
                            Margin="0,0,0,10"
                            Click="OpenWithPs_Click"
                            IsEnabled="False"
                            Style="{StaticResource PrimaryButtonStyle}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Image Source="/Resources/photoshop-icon.png" Width="25" Height="25" Margin="0,0,8,0" />
                                <TextBlock Text="Otwórz w Ps" VerticalAlignment="Center" Foreground="White" />
                            </StackPanel>
                        </Button>

                        <Button x:Name="SaveToXlButton"
                            Height="50"
                            Margin="0,0,0,10"
                            Click="SaveButtonToXl_Click"
                            IsEnabled="False"
                            Style="{StaticResource SuccessButtonStyle}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Image Source="/Resources/xl-icon.png"  Width="20" Height="20" Margin="0,0,8,0" />
                                <TextBlock Text="Zapisz do Xla" VerticalAlignment="Center" Foreground="White" />
                            </StackPanel>
                        </Button>

                        <Button x:Name="SaveButton"
                            Height="50"
                            Margin="0,0,0,10"
                            Click="SaveButton_Click"
                            IsEnabled="False"
                            Style="{StaticResource SuccessButtonStyle}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Image Source="/Resources/save-icon.png" Width="24" Height="24" Margin="0,0,8,0" />
                                <TextBlock Text="Zapisz" VerticalAlignment="Center" Foreground="White" />
                            </StackPanel>
                        </Button>

                        <Button x:Name="RefreshButton"
                            Height="50"
                            Click="RefreshButton_Click"
                            IsEnabled="False"
                            Margin="0,0,0,10"
                            Style="{StaticResource PrimaryButtonStyle}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Image Source="/Resources/refresh-icon.png"  Width="24" Height="24" Margin="0,0,8,0" />
                                <TextBlock Text="Ponów" VerticalAlignment="Center" Foreground="White" />
                            </StackPanel>
                        </Button>

                        <Button x:Name="DeleteButton"
                            Height="50"
                            Click="DeleteButton_Click"
                            IsEnabled="False"
                            Style="{StaticResource DangerButtonStyle}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Image Source="/Resources/delete-icon.png"  Width="25" Height="25" Margin="0,0,8,0" />
                                <TextBlock Text="Usuń" VerticalAlignment="Center" Foreground="White" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- Options Panel -->
                <Border Grid.Column="1"
                    VerticalAlignment="Top"
                    Margin="20"
                    Background="White"
                    CornerRadius="10"
                    Padding="20"
                    Effect="{DynamicResource DropShadowEffect}">

                    <StackPanel>
                        <TextBlock Text="Opcje" FontSize="20" FontWeight="Bold" Margin="0,0,0,20" />

                        <CheckBox x:Name="RemoveBackgroundCheckbox" Content="Usuń tło" Margin="0,0,0,10" IsChecked="True" />
                        <CheckBox x:Name="CropCheckbox" Content="Kadruj" Margin="0,0,0,10" IsChecked="True" />
                        <CheckBox x:Name="ScaleCheckBox" Content="Skaluj" Margin="0,0,0,10" IsChecked="True" />
                        <CheckBox x:Name="WatermarkCheckbox" Content="Dodaj znak wodny" Margin="0,0,0,10" IsChecked="True" />

                        <TextBlock Text="Rozszerzenie" FontWeight="SemiBold" Margin="0,0,0,5" />
                        <ComboBox x:Name="FileExtensionCombobox">
                            <ComboBoxItem IsSelected="True">jpg</ComboBoxItem>
                            <ComboBoxItem>png</ComboBoxItem>
                        </ComboBox>

                        <TextBlock Text="Model AI" FontWeight="SemiBold" Margin="0,5,0,5" />
                        <ComboBox x:Name="AiModelCombobox">
                            <ComboBoxItem IsSelected="True" Tag="u2net">Uniwersalny</ComboBoxItem>
                            <ComboBoxItem Tag="birefnet-massive">Precyzyjny</ComboBoxItem>
                        </ComboBox>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1"
                    VerticalAlignment="Top"
                    Margin="20"
                    Background="White"
                    CornerRadius="10"
                    Padding="20"
                    Effect="{DynamicResource DropShadowEffect}">
                    <StackPanel>
                        <TextBlock Text="Ścieżki folderów" FontSize="20" FontWeight="Bold" Margin="0,0,0,20" />

                        <!-- Input Folder -->
                        <StackPanel Margin="0,0,0,15">
                            <Button Content="📂 Wejściowy"
                                Style="{StaticResource FolderButtonStyle}"
                                HorizontalAlignment="Stretch"
                                Click="SelectFolder_Click"
                                Tag="InputFolder" />
                            <TextBlock x:Name="InputFolderText"
                                VerticalAlignment="Center"
                                Margin="0,5,0,0"
                                TextWrapping="Wrap"
                                FontSize="12"
                                Foreground="#666" />
                        </StackPanel>

                        <!-- Archive Folder -->
                        <StackPanel Margin="0,0,0,15">
                            <Button Content="📂 Archiwum"
                                Style="{StaticResource FolderButtonStyle}"
                                HorizontalAlignment="Stretch"
                                Click="SelectFolder_Click"
                                Tag="ArchiveFolder" />
                            <TextBlock x:Name="ArchiveFolderText"
                                VerticalAlignment="Center"
                                Margin="0,5,0,0"
                                TextWrapping="Wrap"
                                FontSize="12"
                                Foreground="#666" />
                        </StackPanel>

                        <!-- Archive Clean PNG Folder -->
                        <StackPanel Margin="0,0,0,15">
                            <Button Content="📂 Czyste PNG"
                                Style="{StaticResource FolderButtonStyle}"
                                HorizontalAlignment="Stretch"
                                Click="SelectFolder_Click"
                                Tag="ArchiveCleanPngFolder" />
                            <TextBlock x:Name="ArchiveCleanPngFolderText"
                                VerticalAlignment="Center"
                                Margin="0,5,0,0"
                                TextWrapping="Wrap"
                                FontSize="12"
                                Foreground="#666" />
                        </StackPanel>

                        <!-- Output With Watermark -->
                        <StackPanel Margin="0,0,0,15">
                            <Button Content="📂 Z logo"
                                Style="{StaticResource FolderButtonStyle}"
                                HorizontalAlignment="Stretch"
                                Click="SelectFolder_Click"
                                Tag="OutputWithWatermark" />
                            <TextBlock x:Name="OutputWithWatermarkText"
                                VerticalAlignment="Center"
                                Margin="0,5,0,0"
                                TextWrapping="Wrap"
                                FontSize="12"
                                Foreground="#666" />
                        </StackPanel>

                        <!-- Output Without Watermark -->
                        <StackPanel Margin="0,0,0,15">
                            <Button Content="📂 Bez logo"
                                Style="{StaticResource FolderButtonStyle}"
                                HorizontalAlignment="Stretch"
                                Click="SelectFolder_Click"
                                Tag="OutputWithoutWatermark" />
                            <TextBlock x:Name="OutputWithoutWatermarkText"
                                VerticalAlignment="Center"
                                Margin="0,5,0,0"
                                TextWrapping="Wrap"
                                FontSize="12"
                                Foreground="#666" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>